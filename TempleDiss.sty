\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{TempleDiss}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DEPENDENCIES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\RequirePackage{algorithm}
\RequirePackage[noend]{algorithmic}
\RequirePackage{fancyhdr}
\RequirePackage{verbatim}
\RequirePackage{mathrsfs}
\RequirePackage{bm}
\RequirePackage[hyphens]{url}
\RequirePackage{amsmath}
\RequirePackage{amstext,amsxtra,amsthm,amssymb,amsfonts}
\RequirePackage[pdftex]{graphicx}
\RequirePackage{tabularx,ragged2e,booktabs,multirow,wrapfig}
\RequirePackage[labelfont=bf,margin=1cm]{caption}
\RequirePackage{makecell}
\RequirePackage{csquotes}
\RequirePackage[useregional]{datetime2}
\RequirePackage{titlesec}
\RequirePackage[all]{nowidow}

\RequirePackage[doublespacing]{setspace}
\RequirePackage{titlesec, blindtext, color}
\RequirePackage[nottoc]{tocbibind}
\RequirePackage{tocloft}

\RequirePackage[numbers]{natbib}

\RequirePackage{lipsum}

% these are specified by Temple, as of Spring 2017 the requirements were
% 1.5 inch left margin
% 1 inch right margin
% 1 inch top margin
% 1 inch bottom margin
\RequirePackage[top=1in, bottom=1in, left=1.5in, right=1in, includefoot]{geometry}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% COMMANDS, GENERIC
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% Setup ToC %%%

% TOC Whitespace?
\setlength{\cftbeforetoctitleskip}{-3em}
\setlength{\cftbeforeloftitleskip}{-3em}
\setlength{\cftbeforelottitleskip}{-3em}

% TOC Dots
\renewcommand{\cftpartleader}{\cftdotfill{\cftdotsep}}
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}}

% TOC Titles
\renewcommand{\contentsname}{TABLE OF CONTENTS}
\renewcommand{\listfigurename}{LIST OF FIGURES}
\renewcommand{\listtablename}{LIST OF TABLES}

\renewcommand{\cfttoctitlefont}{\hfill\large\bf}
\renewcommand{\cftaftertoctitle}{\hfill\hfill}
\renewcommand{\cftloftitlefont}{\hfill\large\bf}
\renewcommand{\cftafterloftitle}{\hfill}
\renewcommand{\cftlottitlefont}{\hfill\large\bf}
\renewcommand{\cftafterlottitle}{\hfill}

% TOC Spacing
\titleformat{\chapter}[hang]{\centering\normalfont}{}{0pt}{\large}
\renewcommand{\thesection}{\thechapter.\arabic{section}}
\setlength{\cftchapnumwidth}{0pt}
\renewcommand\thechapter{}
\titlespacing{\chapter}{10pt}{0pt}{10pt}

% TOC Font
\renewcommand{\cftchapfont}{\normalfont}
\renewcommand{\cftsecfont}{\normalfont}
\renewcommand{\cftchappagefont}{\normalfont}

% TOC Depth
\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}

% indents!
\cftsetindents{chap}{0em}{1.2em}
\cftsetindents{sec}{0.5in}{1.7em}
\cftsetindents{subsec}{1.0in}{2.5em}
\cftsetindents{subsubsec}{1.5in}{3.3em}
\setlength{\cftfigindent}{0pt}  % remove indentation from figures in LoF
\setlength{\cfttabindent}{0pt}  % remove indentation from tables in LoT

% TOC Margins on page number
\cftsetrmarg{0.75in}

% subsection spacing
\titleformat{\section}[block]{\hspace{0em}\large}{\thesection}{1em}{}
\titleformat{\subsection}[block]{\hspace{4em}\large}{\thesubsection}{1em}{}
\titleformat{\subsubsection}[block]{\hspace{4em}\large}{\thesubsubsection}{1em}{}
\titleformat{\subsubsubsection}[block]{\hspace{4em}\large\normalfont}{\thesubsubsubsection}{1em}{}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DEFINITIONS, GENERIC
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\vertadjust{\vspace{-0.35in}}
\def\twoinmar{\vertadjust\vspace{0.0in}}
\def\twohalfinmar{\vertadjust\vspace{1.5in}}

\def\dotfill{\leaders\hbox{$\m@th \mkern \@dotsep mu.\mkern \@dotsep mu$}\hfill}

\def\producetableofcontents{
	\hyphenchar\font=-1
	\tableofcontents
	\hyphenchar\font=`\-
	\clearpage
}

\def\producelistoffigures{
	\listoffigures
	\clearpage
}
	
\def\producelistoftables{
	\listoftables
	\clearpage
}

\def\producelistofmaps{\listofmaps}
\def\producelistofappendices{\listofappendices}

\def\producelistofabbreviations{
	\listofabbreviations
	\clearpage
}

\def\ps@chappage{%

%\def{\hfil \rm \thepage \hfil}

 \def\@oddhead{}
 \def\@oddfoot{\hfil \rm \thepage \hfil}
 \let\@evenhead\@oddhead 
 \let\@evenfoot\@oddfoot
}

\def\ps@plain{%
% \def\@oddhead{\hfil \rm \thepage \hfil} 
% \def\@oddfoot{}
 \def\@oddhead{}
 \def\@oddfoot{\hfil \rm \thepage \hfil}
 \let\@evenhead\@oddhead 
 \let\@evenfoot\@oddfoot
}

\def\setupTOC{
	\pagenumbering{roman}
	\addtocontents{toc}{\protect\setlength{\cftbeforechapskip}{0em}}
	% for ToC
	\addtocontents{toc}{~\hfill{Page}\par}
	% for LoF
	\addtocontents{lof}{{Figure}~\hfill{Page}\par}
	% for LoT
	\addtocontents{lot}{{Table}~\hfill{Page}\par}
}

\def\setupChapters{
	\addtocontents{toc}{\protect\mbox{ }\protect\newline\noindent{CHAPTER}\par}
	\clearpage
	 % For two-sided printing, make sure Chapter I starts on right-hand page. jg
	\if@twoside
		\ifodd
			\c@page
		\else
			\ttlpg
			\hbox{ }
		\fi
	\fi 
 	\clearpage
	\setcounter{chapter}{0}
	\setcounter{page}{1}
	\renewcommand{\thechapter}{\arabic{chapter}}
 	\renewcommand{\thepage}{\arabic{page}}
 	\pagestyle{plain}
 	\def\tocname{toc}
}

\def\@chapter[#1]#2{%

\addtocontents{toc}{\protect\begin{singlespace}}

 \ifnum \c@secnumdepth >\m@ne
  \refstepcounter{chapter}
  \typeout{\@chapapp\thechapter.}

  \addcontentsline{toc}{chapter}{\protect\numberline{\thechapter.}{#1}}

 \else

  \addcontentsline{toc}{chapter}{#1}

 \fi
 \if@twocolumn \@topnewpage[\@makechapterhead{#2}]
 \else
 	\@makechapterhead{#2}
 	\@afterheading
 \fi

\addtocontents{toc}{\protect\end{singlespace}}

}

\def\@makechapterhead#1{%
 \hbox{ }
 \twoinmar
 {\parindent 0pt \raggedright
  \ifnum \c@secnumdepth >\m@ne
  \centerline{\large\bf \@chapapp{} \thechapter} \par
  \vskip 0.3in \fi
  \begin{center}
   \large\bf #1
  \end{center}
  \nobreak \vskip 0.7in
 }
 \@afterindenttrue
}

\newlength{\@headingTextWidth}
\newcommand{\pyramid}[1]%
{%
    \leavevmode\vbox{%
        \hsize=4.5in
        \parindent=0pt
        \parfillskip=0pt
        \emergencystretch=2em
        %
        \pretolerance=500
        \tolerance=1000
        \hyphenpenalty=10000
        \linepenalty=0
        %
        \settowidth{\@headingTextWidth}{#1}%
        \ifdim\@headingTextWidth<4.5in%
            % True case - the heading will be only one line.
            % Add fils to the [left/right]skips to avoid distracting underful hbox complaints.
            \leftskip=0pt plus 0.5fil
            \rightskip=0pt plus 0.5fil
        \else%
            % False case - multiline heading.
            % Match the rubber in the [left/right]skips to the pyramid steps to ensure that each
            % successive line is shorter than the previous.
            \leftskip=0pt plus 0.30in
            \rightskip=0pt plus 0.30in
        \fi%
        %
        \bf\Large\MakeUppercase{#1}%
        %
        \parshape=6 % account for a maximum of six lines - thereafter all will have the final width
            0.00in 4.5in
            0.25in 4.0in
            0.50in 3.5in
            0.75in 3.0in
            1.00in 2.5in
            1.25in 2.0in
    }% \vbox
}% \centeredHeadingPar

%\def\section{
%	\@startsection{section}{1}{\z@}{3.5ex plus 1ex minus .2ex}{2.3ex plus .2ex}{\normalsize}
%}

%\def\subsection{
%	\@startsection{subsection}{2}{\z@}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}{\normalsize}
%}
	
%\def\subsubsection{
%	\@startsection{subsubsection}{3}{\z@}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}{\normalsize}
%}

\long\def\@caption#1[#2]#3{

 	\addcontentsline
 	{\csname ext@#1\endcsname}
 	{#1}
 	{\protect\numberline{\csname the#1\endcsname}{\ignorespaces\protect\small\protect\normalsize\rm #2}}
	
	\ifcsname figure\endcsname
	
		\begingroup
	
		\@makeFcaption
			{\csname fnum@#1\endcsname}
			{#2}
			{\ignorespaces\protect\small\normalsize\rm #3}
		
		\endgroup
	
	\else
		\ifcsname table\endcsname
	
			\begingroup
	
			\@makeTcaption
				{\csname fnum@#1\endcsname}
				{#2}
				{\ignorespaces\protect\small\normalsize\rm #3}
		
			\endgroup
		\else
		
			% no eliseif, on your own for other captions
		
		\fi
		
	\fi
	
}

\long\def\@makeTcaption#1#2#3{

	\@makecaption{#1}{#2}{#3}

}

\long\def\@makeFcaption#1#2#3{

	\@makecaption{#1}{\underline{#2}}{#3}
	
}

\long\def\@makecaption#1#2#3{
	
	\vskip 10pt
	\setbox\@tempboxa\hbox{#1. #2. #3}
	
	\ifdim \wd\@tempboxa >\hsize
		\setbox\@tempboxa\hbox{#1. }
		
		\def\@tempdimj{\hsize}
		\advance\@tempdimj -\wd\@tempboxa
		\hbox to\hsize{#1. \parbox[t]{\@tempdimj}{#2. #3}}
		
	\else
	
		\hbox to\hsize{\hfill\box\@tempboxa\hfill}
		
	\fi
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% SPECIFIC PAGES
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\def\ttlpg{\@restonecolfalse \if@twocolumn \@restonecoltrue \onecolumn
 \else \newpage \fi \thispagestyle{empty} \c@page \z@}
 
\def\titlepage#1#2#3#4#5#6{
 \ttlpg
 \begin{singlespace}
 \hbox{ }
 \twohalfinmar
 \begin{center}
 \begin{onehalfspacing} % For the `Large' font size, this will look single spaced. -jg
  {\pyramid{#1} \mbox{}} \\
  \underline{\hspace{6in}}\\ 
 \end{onehalfspacing}
  
  \vspace{7.5mm}
  A Dissertation \\
  Submitted to \\
  #2\\
  \vspace{7.5mm}
  \underline{\hspace{6in}}\\
  
  \vspace{7.5mm}
  in Partial Fulfillment\\
  of the Requirements for the Degree \\
   #3 \\
  \vspace{7.5mm}
  \underline{\hspace{6in}}\\ 
  \vspace{7.5mm}
  by \\
  #4 \\
  #5 \\  

 \end{center}
 \vspace{10mm}
  Examining Committee Members: \\[2ex]
  \\
  %\mbox{ }\hspace{0in}
  \parbox{5.3in}{#6} 
 \end{singlespace}
}

\def\copyrightpage#1#2{
% \pagestyle{chappage}   
% \ttlpg
 \newpage
 \hbox{ }
 \vertadjust
 \vfill
 \begin{center}
  \begin{singlespace}
   \copyright\hspace{0.2in} \\ {#1}\hspace{0.2in} \\ \number\year\\[12pt]
  by \\[12pt]
%  \vspace{2ex} % ex 
   \underline{\hspace{0.2in}{#2}\hspace{0.2in}}\\
   \vspace{0.1in}All Rights Reserved
  \end{singlespace}
 \end{center}
 \vfill
}

% update for Temple's Abstract requirement of `Abstract' and double spaced
\def\startabstractpage{% This formats the optional in-dissertation abstract
 \newpage
 \addcontentsline{toc}{chapter}{ABSTRACT}
 \@restonecolfalse\if@twocolumn\@restonecoltrue\onecolumn\fi
 \hbox{ }
 \twoinmar
 \centerline{\large\bf ABSTRACT}
 \vspace{0.25in}
}

\def\startacknowledgementspage{
 \newpage
 \addcontentsline{toc}{chapter}{ACKNOWLEDGEMENTS}
 \hbox{ }
 \twoinmar
 \centerline{\large\bf ACKNOWLEDGEMENTS}
 \vspace{0.7in}
}

\def\dedicationpage#1{
 \newpage
 \addcontentsline{toc}{chapter}{DEDICATION}
 \hbox{ }
 \vertadjust
 \vfill
 \begin{center}
  #1
 \end{center}
 \vfill
 \clearpage
}

\def\listofabbreviations{% Uses the acronym package -jg
 \newpage
 \addcontentsline{toc}{chapter}{LIST OF ABBREVIATIONS}
 \@restonecolfalse\if@twocolumn\@restonecoltrue\onecolumn\fi
 \hbox{ }
 \twoinmar
 \centerline{\large\bf LIST OF ABBREVIATIONS}
 \vspace{0.7in}
 \begin{singlespace}
  \begin{acronym}
   \input{abbr}
  \end{acronym}
 \end{singlespace} 
}

\def\startbibliography{% This sets things up for BibTeX
 %\clearpage
 \hbox{}
 \if@twoside \ifodd\c@page \else\thispagestyle{empty} \clearpage\hbox{} \fi\fi
 \thispagestyle{chappage}
 %\addcontentsline{toc}{chapter}{BIBLIOGRAPHY}
 \hbox{ }
 \vertadjust
 \vfill
 %\centerline{\large\bf BIBLIOGRAPHY} % The half title page
 \vfill
 \renewcommand{\bibname}{\vspace{-1.00in}\centerline{\large\bf BIBLIOGRAPHY}}
}

\def\startappendices{\par
 \def\thechapter {\Alph{chapter}}
 \def\theappendix{\Alph{chapter}}
 \def\thesection{\theappendix.\arabic{section}}
 \def\theequation{{\rm \theappendix}.\arabic{equation}}
 \def\thefigure{{\rm \theappendix}.\@arabic\c@figure}
 \def\thetable{{\rm \theappendix}.\@arabic\c@table}
 \def\themap{{\rm \theappendix}.\@arabic\c@map}

 \setcounter{chapter}{0}
 \setcounter{page}{1}
 \def\@chapapp{APPENDIX}
 \pagestyle{plain}
%\clearpage 
 \hbox{}
 \if@twoside \ifodd\c@page \else\thispagestyle{empty} \clearpage\hbox{}\fi\fi
 \thispagestyle{chappage}
 \addtocontents{toc}{\protect\mbox{ }\protect\newline\noindent{APPENDICES}}
 \addtocontents{toc}{\hbox{ }}
 %\vertadjust
 %\vfill
 %\centerline{\large\bf APPENDICES} % The half title page
 %\vfill
}

\def\appendix#1{%
 \clearpage \global\@topnum\z@ \@afterindenttrue
 \refstepcounter{chapter}
 \typeout{\@chapapp\space\theappendix.}
 \hbox{}
 \if@twoside \ifodd\c@page \else\thispagestyle{empty} \clearpage\hbox{}\fi\fi
 \addtocontents{loa}{\hbox{ }}
 \addcontentsline{loa}{appendix}{\protect\numberline{\theappendix.}{\ignorespaces\rm #1}}
 \hbox{ }
 \twoinmar
 \centerline{\large\bf \@chapapp{} \theappendix} \par
 \vspace{0.1in}
 \begin{center}
  \large\bf #1
 \end{center}
 \vspace{0.1in}
 \par\@afterindenttrue
}

\def\endofchapterbibliography{%
 \clearpage
 \hbox{ }
 \twoinmar
 \begin{center}
  {\large \bf BIBLIOGRAPHY}
 \end{center}
 \vspace{0.75in}
}

\def\thebibliography#1{% If using BibTeX, this code is ignored
 \clearpage
 \hbox{}
 \if@twoside \ifodd\c@page \else\thispagestyle{empty} \clearpage\hbox{} \fi\fi
 \thispagestyle{chappage}
 \addcontentsline{toc}{chapter}{BIBLIOGRAPHY}
 \hbox{ }
 \vertadjust
 \vfill
 \centerline{\large\bf BIBLIOGRAPHY} % Half title page
 \vfill
 \newpage
 \hbox{ }
 \twoinmar
 \centerline{\large\bf BIBLIOGRAPHY}
 \vspace{0.7in}
 \list{[\arabic{enumi}]}{\settowidth\labelwidth{[#1]}\leftmargin\labelwidth
 \advance\leftmargin\labelsep
 \usecounter{enumi}}
 \def\newblock{\hskip .11em plus .33em minus -.07em}
 \sloppy\clubpenalty4000\widowpenalty4000
 \sfcode`\.=1000\relax}
\let\endthebibliography=\endlist

\def\startextabstractpage#1#2#3{% This formats an external Abstract that can be printed at the end of the document. Comment it out in thesis.tex when not needed. - jg
 \ttlpg
 \@restonecolfalse\if@twocolumn\@restonecoltrue\onecolumn\fi
 \hbox{ }
 \centerline{\large\bf ABSTRACT}
 \vspace{0.25in}
 \begin{center}
  \begin{singlespace}
   #1 \\
  \end{singlespace}
   by \\
   #2 \\
 \end{center}
 \vspace{0.4in}
 \noindent #3
 \vspace{0.25in}\\
 \pagestyle{empty}
}